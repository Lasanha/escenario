{% extends 'base.html' %}


{% block corpo %}

<h2>FALTA!! OE PENALTI!!</h2>
<p>
<a id="show-voted" href="#">Mais Votadas</a>
<a id="show-recent" href="#">Mais Recentes</a>
</p>

<div id="escenario-list">
</div>

<div class="pagination">
    <span class="step-links">
        <a href="#" id="show-previous">Anterior</a>
        Página <span id="current-page"></span> of <span id="total-pages"></span>
        <a href="#" id="show-next">Próxima</a>
    </span>
</div>


{% endblock %}

{% block scripts %}
<script>
    function vote_callback(escenario_id){
        var target_id = parseInt(escenario_id);
        var target_span = "#span" + target_id;
        result = $.post(
            "/v2/escenarios/" + target_id + "/like/",
            function(result) {
                $(target_span).text(result.new_count);
            },
            "json")
    }
</script>
<script>
    var listManager = new manager.ListManager();
    var votedShowcase = new manager.VotedShowcase();
    var ordering = '-votos';
    var current_page = 1;

    var show = function () {
        var data = listManager.getEscenarios(ordering, current_page, false);
        votedShowcase.showVoted(data.results, "#escenario-list");
        $(".vote-button").click(function (e) {
            vote_callback(e.target.id);
        });
        data.next !== null ? $("#show-next").show(): $("#show-next").hide();
        data.previous !== null ? $("#show-previous").show(): $("#show-previous").hide();
        $("#current-page").text(data.current);
        $("#total-pages").text(data.totalPages);
    };

    show('first');

    $("#show-voted").click(function () {
        ordering = '-votos';
        show();
    });

    $("#show-recent").click(function () {
        ordering = '-criado_em';
        show();
    });

    $("#show-previous").click(function () {
        current_page -= 1;
        show();
    });

    $("#show-next").click(function () {
        current_page += 1;
        show();
    });

</script>
{% endblock %}
